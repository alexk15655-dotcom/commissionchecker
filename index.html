<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°–∏—Å—Ç–µ–º–∞ —Ä–∞—Å—á—ë—Ç–∞ –∫–æ–º–∏—Å—Å–∏–π v6.0</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <div class="app">
        <header class="header">
            <h1>–°–∏—Å—Ç–µ–º–∞ —Ä–∞—Å—á–µ—Ç–∞ –∫–æ–º–∏—Å—Å–∏–π</h1>
            <p class="subtitle">MVP –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤—ã–ø–ª–∞—Ç–∞–º–∏ –∞–≥–µ–Ω—Ç–∞–º ‚Ä¢ –í–µ—Ä—Å–∏—è 6.0</p>
            <button id="theme-toggle" class="theme-toggle" aria-label="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É">
                <span class="theme-icon">üåô</span>
            </button>
        </header>

        <nav class="tabs">
            <button class="tab active" data-tab="upload">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö</button>
            <button class="tab" data-tab="managers">–ú–µ–Ω–µ–¥–∂–µ—Ä—ã</button>
            <button class="tab" data-tab="rules">–ü—Ä–∞–≤–∏–ª–∞ –∫–æ–º–∏—Å—Å–∏–π</button>
            <button class="tab" data-tab="milestones">Milestones</button>
            <button class="tab" data-tab="fg">–§–ì</button>
            <button class="tab" data-tab="report">–û—Ç—á–µ—Ç</button>
            <button class="tab" data-tab="settings">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
        </nav>

        <main class="content">
            <!-- Upload Tab -->
            <section id="upload-tab" class="tab-content active">
                <!-- –ü–ï–†–ò–û–î –û–¢–ß–Å–¢–ê (–Ω–æ–≤—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –∏–∑ GitHub) -->
                <div style="background: var(--bg-secondary); padding: 1.5rem; border-radius: 12px; margin-bottom: 2rem; border-left: 4px solid var(--accent-primary); box-shadow: 0 2px 8px var(--shadow);">
                    <h3 style="margin-bottom: 1rem; color: var(--accent-primary); display: flex; align-items: center; gap: 0.5rem;">
                        üìÖ –ü–µ—Ä–∏–æ–¥ –æ—Ç—á—ë—Ç–∞
                    </h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 0.5rem;">
                        <div class="form-group" style="margin-bottom: 0;">
                            <label>–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞</label>
                            <input type="date" id="global-start-date" style="width: 100%;">
                        </div>
                        <div class="form-group" style="margin-bottom: 0;">
                            <label>–î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è</label>
                            <input type="date" id="global-end-date" style="width: 100%;">
                        </div>
                    </div>
                    <small style="color: var(--text-tertiary); display: block;">
                        ‚ÑπÔ∏è –≠—Ç–æ—Ç –ø–µ—Ä–∏–æ–¥ –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–º–µ–Ω—ë–Ω –ø—Ä–∏ —Ä–∞—Å—á—ë—Ç–µ –æ—Ç—á—ë—Ç–∞. –ò–∑–º–µ–Ω–∏—Ç—å –º–æ–∂–Ω–æ –≤ –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç.
                    </small>
                </div>

                <div class="card">
                    <h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è</h2>
                    
                    <div class="form-group">
                        <label>–°—Ç–∞—Ä—Ç–æ–≤–∞—è –∫–æ–º–∏—Å—Å–∏—è (%)</label>
                        <input type="number" id="default-commission" value="5" step="0.1" min="0" max="100">
                    </div>

                    <div class="distributions">
                        <h3>–ü—Ä–æ–ø–æ—Ä—Ü–∏–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ (%)</h3>
                        <div class="slider-group">
                            <label>Recruiter <span id="recruiter-value">30</span>%</label>
                            <input type="range" id="recruiter-slider" min="0" max="100" value="30">
                        </div>
                        <div class="slider-group">
                            <label>Account <span id="account-value">25</span>%</label>
                            <input type="range" id="account-slider" min="0" max="100" value="25">
                        </div>
                        <div class="slider-group">
                            <label>–ü—Ä–æ–µ–∫—Ç <span id="project-value">25</span>%</label>
                            <input type="range" id="project-slider" min="0" max="100" value="25">
                        </div>
                        <div class="slider-group">
                            <label>–û—Ä–≥–∞–Ω–∏–∫–∞ <span id="organic-value">15</span>%</label>
                            <input type="range" id="organic-slider" min="0" max="100" value="15">
                        </div>
                        <div class="slider-group">
                            <label>–ê–∫—Ü–∏—è <span id="promo-value">5</span>%</label>
                            <input type="range" id="promo-slider" min="0" max="100" value="5">
                        </div>
                    </div>
                </div>

                <div class="upload-grid">
                    <div class="card">
                        <h3>–ó–∞–≥—Ä—É–∑–∫–∞ –§–ì</h3>
                        <input type="file" id="fg-upload" accept=".csv">
                        <div id="fg-status" class="status"></div>
                        <button id="distribute-btn" class="btn btn-primary" disabled>–†–∞—Å–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫–∏</button>
                    </div>

                    <div class="card">
                        <h3>–ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–µ–¥–æ–ø–ª–∞—Ç</h3>
                        <input type="file" id="prepayments-upload" accept=".csv">
                        <div id="prepayments-status" class="status"></div>
                    </div>
                </div>
            </section>

            <!-- Managers Tab -->
            <section id="managers-tab" class="tab-content">
                <div class="managers-grid">
                    <div class="card">
                        <div class="card-header">
                            <h3>Recruiters</h3>
                            <button class="btn btn-small btn-primary" id="add-recruiter-btn">+ –î–æ–±–∞–≤–∏—Ç—å</button>
                        </div>
                        <div id="recruiters-list" class="managers-list"></div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3>Account Managers</h3>
                            <button class="btn btn-small btn-primary" id="add-account-btn">+ –î–æ–±–∞–≤–∏—Ç—å</button>
                        </div>
                        <div id="accounts-list" class="managers-list"></div>
                    </div>
                </div>
            </section>

            <!-- Rules Tab -->
            <section id="rules-tab" class="tab-content">
                <div class="card">
                    <div class="card-header">
                        <h2>–ü—Ä–∞–≤–∏–ª–∞ –∫–æ–º–∏—Å—Å–∏–π</h2>
                        <button class="btn btn-primary" id="add-rule-btn">+ –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∞–≤–∏–ª–æ</button>
                    </div>
                    <div id="rules-list" class="rules-list"></div>
                </div>
            </section>

            <!-- Milestones Tab -->
            <section id="milestones-tab" class="tab-content">
                <div class="card">
                    <div class="card-header">
                        <h2>Milestones</h2>
                        <button class="btn btn-primary" id="add-milestone-btn">+ –î–æ–±–∞–≤–∏—Ç—å Milestone</button>
                    </div>
                    <div id="milestones-list" class="milestones-grid"></div>
                </div>
            </section>

            <!-- FG Tab -->
            <section id="fg-tab" class="tab-content">
                <div class="card">
                    <div class="card-header">
                        <div>
                            <h2>–§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –≥—Ä—É–ø–ø—ã</h2>
                            <p style="color: var(--text-secondary); margin-bottom: 0;">
                                –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö –§–ì —Å –∞–≥–µ–Ω—Ç–∞–º–∏, –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º–∏, –º–µ–Ω–µ–¥–∂–µ—Ä–∞–º–∏ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π –ø–æ –ø—Ä–µ–¥–æ–ø–ª–∞—Ç–∞–º
                            </p>
                        </div>
                        <button class="btn btn-primary" id="generate-missing-data-btn" style="white-space: nowrap;">
                            ‚ú® –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ
                        </button>
                    </div>
                    <div class="table-wrapper">
                        <table id="fg-table">
                            <thead>
                                <tr>
                                    <th>–§–ì</th>
                                    <th>–ù–æ–º–µ—Ä –§–ì</th>
                                    <th>–ê–≥–µ–Ω—Ç</th>
                                    <th>–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è –§–ì</th>
                                    <th>–ü–µ—Ä–≤–∞—è –ø—Ä–µ–¥–æ–ø–ª–∞—Ç–∞</th>
                                    <th>–†–µ—Ñ</th>
                                    <th>–ò—Å—Ç–æ—á–Ω–∏–∫</th>
                                    <th>–ú–µ–Ω–µ–¥–∂–µ—Ä</th>
                                    <th>–°—É–º–º–∞ –ø—Ä–µ–¥–æ–ø–ª–∞—Ç</th>
                                    <th>–í—ã–ø–ª–∞—á–µ–Ω–æ –∫–æ–º–∏—Å—Å–∏–∏</th>
                                </tr>
                            </thead>
                            <tbody id="fg-tbody">
                                <tr>
                                    <td colspan="10" style="text-align: center; color: var(--text-tertiary); padding: 2rem;">
                                        –ó–∞–≥—Ä—É–∑–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –ø–æ –§–ì
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Report Tab -->
            <section id="report-tab" class="tab-content">
                <div class="card">
                    <h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –æ—Ç—á–µ—Ç–∞</h2>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞ –ø–µ—Ä–∏–æ–¥–∞</label>
                            <input type="date" id="report-start-date">
                        </div>
                        <div class="form-group">
                            <label>–î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è –ø–µ—Ä–∏–æ–¥–∞</label>
                            <input type="date" id="report-end-date">
                        </div>
                    </div>
                    <button class="btn btn-primary" id="calculate-btn">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å –∫–æ–º–∏—Å—Å–∏–∏</button>
                    <div style="margin-top: 1rem;">
                        <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                            <input type="checkbox" id="hide-zero-commission-agents" style="cursor: pointer;">
                            <span>–°–∫—Ä—ã—Ç—å –∞–≥–µ–Ω—Ç–æ–≤ –±–µ–∑ –∫–æ–º–∏—Å—Å–∏–∏</span>
                        </label>
                    </div>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <h3>–í—Å–µ–≥–æ –ø—Ä–µ–¥–æ–ø–ª–∞—Ç</h3>
                        <p class="stat-value" id="total-prepayments">$0.00</p>
                    </div>
                    <div class="stat-card">
                        <h3>–í—Å–µ–≥–æ –∫–æ–º–∏—Å—Å–∏–π</h3>
                        <p class="stat-value" id="total-commissions">$0.00</p>
                    </div>
                    <div class="stat-card">
                        <h3>–ú–µ–Ω–µ–¥–∂–µ—Ä–æ–≤</h3>
                        <p class="stat-value" id="total-managers">0</p>
                    </div>
                </div>

                <div class="card">
                    <h2>–î–µ—Ç–∞–ª—å–Ω—ã–π –æ—Ç—á—ë—Ç (—Ç—Ä—ë—Ö—É—Ä–æ–≤–Ω–µ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞)</h2>
                    <p style="color: var(--text-secondary); margin-bottom: 1rem;">
                        –ú–µ–Ω–µ–¥–∂–µ—Ä ‚Üí –ê–≥–µ–Ω—Ç ‚Üí –§–ì ‚Ä¢ –ö–ª–∏–∫–∞–π—Ç–µ –¥–ª—è —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏—è/—Å–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏—è
                    </p>
                    <div class="table-wrapper">
                        <table id="report-table">
                            <thead>
                                <tr>
                                    <th colspan="2">–ú–µ–Ω–µ–¥–∂–µ—Ä / –ê–≥–µ–Ω—Ç / –§–ì</th>
                                    <th>–ù–æ–º–µ—Ä –§–ì</th>
                                    <th>–ò—Å—Ç–æ—á–Ω–∏–∫</th>
                                    <th>–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç—ã</th>
                                    <th>–î–∞—Ç–∞ –ø–µ—Ä–≤–æ–π –ø—Ä–µ–¥–æ–ø–ª–∞—Ç—ã</th>
                                    <th>–ü—Ä–µ–¥–æ–ø–ª–∞—Ç—ã</th>
                                    <th>–ö–æ–º–∏—Å—Å–∏—è</th>
                                    <th>Milestone</th>
                                    <th>–ò—Ç–æ–≥–æ</th>
                                </tr>
                            </thead>
                            <tbody id="report-tbody">
                                <tr>
                                    <td colspan="10" style="text-align: center; color: var(--text-tertiary); padding: 2rem;">
                                        –ó–∞–≥—Ä—É–∑–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –∫–æ–º–∏—Å—Å–∏–π
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Settings Tab (–Ω–æ–≤—ã–π –∏–∑ GitHub) -->
            <section id="settings-tab" class="tab-content">
                <div class="card">
                    <h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã</h2>
                    
                    <h3 style="margin-top: 1.5rem;">–≠–∫—Å–ø–æ—Ä—Ç/–ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</h3>
                    <div style="display: flex; gap: 1rem; margin-top: 1rem;">
                        <button class="btn btn-primary" id="export-btn">üì• –≠–∫—Å–ø–æ—Ä—Ç –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö</button>
                        <button class="btn btn-primary" id="import-btn">üì§ –ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</button>
                        <input type="file" id="import-file" accept=".json" style="display: none;">
                    </div>
                    <p style="color: var(--text-tertiary); margin-top: 0.5rem; font-size: 0.9rem;">
                        –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é –≤—Å–µ—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫, –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤, –ø—Ä–∞–≤–∏–ª –∏ milestones
                    </p>

                    <h3 style="margin-top: 2rem; color: var(--danger);">–û—á–∏—Å—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö</h3>
                    <button class="btn btn-danger" id="clear-all-btn">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ</button>
                    <p style="color: var(--text-tertiary); margin-top: 0.5rem; font-size: 0.9rem;">
                        ‚ö†Ô∏è –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–æ–±—Ä–∞—Ç–∏–º–æ. –°–¥–µ–ª–∞–π—Ç–µ —ç–∫—Å–ø–æ—Ä—Ç –ø–µ—Ä–µ–¥ –æ—á–∏—Å—Ç–∫–æ–π.
                    </p>
                </div>
            </section>
        </main>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ -->
    <div id="modal" class="modal">
        <div class="modal-content">
            <span class="modal-close">&times;</span>
            <div id="modal-body"></div>
        </div>
    </div>

    <!-- –ë–∏–±–ª–∏–æ—Ç–µ–∫–∏ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    
    <!-- –°–∫—Ä–∏–ø—Ç—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è -->
    <script src="js/db.js"></script>
    <script src="js/managers.js"></script>
    <script src="js/rules.js"></script>
    <script src="js/milestones.js"></script>
    <script src="js/fg.js"></script>
    <script src="js/report.js"></script>
    <script src="js/app.js"></script>

    <script>
    // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞ —Å –æ—Ç—á—ë—Ç–æ–º
    document.addEventListener('DOMContentLoaded', () => {
        const globalStart = document.getElementById('global-start-date');
        const globalEnd = document.getElementById('global-end-date');
        const reportStart = document.getElementById('report-start-date');
        const reportEnd = document.getElementById('report-end-date');
        
        // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞
        if (globalStart && reportStart) {
            globalStart.addEventListener('change', () => {
                reportStart.value = globalStart.value;
            });
        }
        
        if (globalEnd && reportEnd) {
            globalEnd.addEventListener('change', () => {
                reportEnd.value = globalEnd.value;
            });
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–Ω–∞—á–µ–Ω–∏—è–º–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (—Ü–µ–ª—ã–π –ø—Ä–µ–¥—ã–¥—É—â–∏–π –º–µ—Å—è—Ü)
        const now = new Date();
        const prevMonthStart = new Date(now.getFullYear(), now.getMonth() - 1, 1);
        const prevMonthEnd = new Date(now.getFullYear(), now.getMonth(), 0); // –ø–æ—Å–ª–µ–¥–Ω–∏–π –¥–µ–Ω—å –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –º–µ—Å—è—Ü–∞

        const prevMonthStartStr = prevMonthStart.toISOString().split('T')[0];
        const prevMonthEndStr = prevMonthEnd.toISOString().split('T')[0];

        if (globalStart && !globalStart.value) globalStart.value = prevMonthStartStr;
        if (globalEnd && !globalEnd.value) globalEnd.value = prevMonthEndStr;
        if (reportStart && !reportStart.value) reportStart.value = prevMonthStartStr;
        if (reportEnd && !reportEnd.value) reportEnd.value = prevMonthEndStr;

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–∫–∏ —Ä–∞—Å—á—ë—Ç–∞
        const calculateBtn = document.getElementById('calculate-btn');
        if (calculateBtn) {
            calculateBtn.addEventListener('click', () => {
                if (window.reportCtrl) {
                    reportCtrl.calculate();
                }
            });
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —ç–∫—Å–ø–æ—Ä—Ç–∞/–∏–º–ø–æ—Ä—Ç–∞
        const exportBtn = document.getElementById('export-btn');
        if (exportBtn) {
            exportBtn.addEventListener('click', async () => {
                const data = {
                    version: '6.0',
                    exportDate: new Date().toISOString(),
                    fgData: await db.getAll('fgData'),
                    prepaymentsData: await db.getAll('prepaymentsData'),
                    recruiters: await db.getAll('recruiters'),
                    accountManagers: await db.getAll('accountManagers'),
                    rules: await db.getAll('rules'),
                    milestones: await db.getAll('milestones'),
                    settings: {
                        distribution: app.sourceDistribution,
                        defaultCommission: app.defaultCommission
                    }
                };

                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `commission-system-backup-${new Date().toISOString().split('T')[0]}.json`;
                a.click();
                URL.revokeObjectURL(url);
            });
        }

        const importBtn = document.getElementById('import-btn');
        const importFile = document.getElementById('import-file');
        
        if (importBtn && importFile) {
            importBtn.addEventListener('click', () => {
                importFile.click();
            });

            importFile.addEventListener('change', async (e) => {
                const file = e.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = async (event) => {
                    try {
                        const data = JSON.parse(event.target.result);
                        
                        if (!confirm('–ò–º–ø–æ—Ä—Ç –ø–µ—Ä–µ–∑–∞–ø–∏—à–µ—Ç –≤—Å–µ —Ç–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ. –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å?')) return;

                        // –û—á–∏—â–∞–µ–º –∏ –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ
                        await db.clear('fgData');
                        await db.clear('prepaymentsData');
                        await db.clear('recruiters');
                        await db.clear('accountManagers');
                        await db.clear('rules');
                        await db.clear('milestones');

                        for (const fg of data.fgData || []) await db.save('fgData', fg);
                        for (const prep of data.prepaymentsData || []) await db.save('prepaymentsData', prep);
                        for (const rec of data.recruiters || []) await db.save('recruiters', rec);
                        for (const acc of data.accountManagers || []) await db.save('accountManagers', acc);
                        for (const rule of data.rules || []) await db.save('rules', rule);
                        for (const mile of data.milestones || []) await db.save('milestones', mile);

                        if (data.settings) {
                            app.sourceDistribution = data.settings.distribution;
                            app.defaultCommission = data.settings.defaultCommission;
                            await app.saveSettings();
                        }

                        alert('–ò–º–ø–æ—Ä—Ç –∑–∞–≤–µ—Ä—à—ë–Ω —É—Å–ø–µ—à–Ω–æ!');
                        location.reload();
                    } catch (error) {
                        alert('–û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞: ' + error.message);
                    }
                };
                reader.readAsText(file);
            });
        }

        const clearAllBtn = document.getElementById('clear-all-btn');
        if (clearAllBtn) {
            clearAllBtn.addEventListener('click', async () => {
                if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã? –≠—Ç–æ —É–¥–∞–ª–∏—Ç –í–°–ï –¥–∞–Ω–Ω—ã–µ –±–µ–∑ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è!')) return;
                if (!confirm('–ü–æ—Å–ª–µ–¥–Ω–µ–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ: –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã!')) return;

                await db.clear('fgData');
                await db.clear('prepaymentsData');
                await db.clear('recruiters');
                await db.clear('accountManagers');
                await db.clear('rules');
                await db.clear('milestones');

                alert('–í—Å–µ –¥–∞–Ω–Ω—ã–µ –æ—á–∏—â–µ–Ω—ã');
                location.reload();
            });
        }
    });
    </script>
</body>
</html>